<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MAME Roms example</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>

<script type="text/javascript" src="../../src/unicode/categ_letters_numbers.js"></script>
<script type="text/javascript" src="../../src/unicode/normalizer_lowercase_nomark.js"></script>
<script type="text/javascript" src="../../src/unicode/unicode.js"></script>

<script type="text/javascript" src="../../src/analyzers.js"></script>
<script type="text/javascript" src="../../src/normalizers.js"></script>
<script type="text/javascript" src="../../src/normalizers/english/metaphone.js"></script>
<script type="text/javascript" src="../../src/misc/dataloader.js"></script>
<script type="text/javascript" src="../../src/capabilities.js"></script>

<script type="text/javascript" src="../../src/utils.js"></script>
<script type="text/javascript" src="../../src/scoring-engine.js"></script>
<script type="text/javascript" src="../../src/common-engine.js"></script>
<script type="text/javascript" src="../../src/resultsets.js"></script>
<script type="text/javascript" src="../../src/storemanager.js"></script>
<script type="text/javascript" src="../../src/stores/memory_store.js"></script>
    <script type="text/javascript" src="../../src/stores/websql_store.js"></script>
    <script type="text/javascript" src="../../src/stores/indexeddb_store.js"></script>

    <script type="text/javascript" src="mamesearch.js"></script>

<style TYPE="text/css">

div.floatbox {
	float:left; width: 300px;
}
div.resultbox {
	border: 1px solid black; margin:0.5em;
	color: black; background-color: #EEEEEE;
	overflow: hidden;
}
textarea.typebox {
	float: left;
	width: 300px; height: 200px; margin:1em;"
	color: black; background-color: white;
}
</style>
</head>
<body>
<h1>Search the MAME ROMs</h1>

<div>
This sampple application provides an example of fulltext search in the database of ROMs supported by
<a href="http://mamedev.org/">the MAME emulator</a>. 
</div>
<div>
It uses the ScoringEngine to search for results in the inverted indexes, and sorts them according to a score
evaluated according to the scoring rules defined in the engine.
</div>

<div style="display: none;" id="application">
	Search a game:
	<div>
		<input type="text" id="typehere" class="typebox">
		<button id="search">Search</button>
		<button id="reload">Reload database</button>
	</div>
	<div style="clear:both" id="results">
	</div>
</div>
<div id="loading">
Application is loading: <span id="progress"></span>%
</div>
<script type="text/javascript">

$(document).ready(function() {

	MameSearch.start(function(i)Â {
		if (i) {
			$("#loading").hide();
			$("#application").show();
		}
	}, function(progress) {
		$("#progress").html(parseInt(progress*100));
	});

	var now = (function() {
		var perf = window.performance || {};
		var fn = perf.now || perf.mozNow || perf.webkitNow || perf.msNow || perf.oNow;
		// fn.bind will be available in all the browsers that support the advanced window.performance... ;-)
		return fn ? fn.bind(perf) : function() { return new Date().getTime(); };
		})();

	function search() {
		var value = $("#typehere").val();
		
		var startTime = now();
		
		MameSearch.lookup(value, function(result) {
			var time = now() - startTime;
			time = time.toFixed(3);
			result = "<div>Request processed in " + time + " ms</div>" + result;
			$("#results").html(result);
		});
	}

	$("#search").click(search);
	$("#typehere").change(search);
	$("#reload").click(function() {
		MameSearch.reloadDatabase(function() {
			window.location.reload(true);
		});	
	});
	
});</script>
</body>
</html>